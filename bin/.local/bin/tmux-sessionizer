#!/usr/bin/bash
find_param="-mindepth 1 -maxdepth 1 -type d"
dir_list=("
	/home/cyphics/Documents/admin/CV/moi/
	")

if [[ $# -eq 1 ]]; then
    selected=$1
else
	first=$(find ~/ ~/work/ ~/ownCloud/ ~/ownCloud/dotfiles ~/ownCloud/programming/projects/ ~/ownCloud/programming/courses/ $find_param)
	list=("${first[@]}" "${dir_list[@]}")
	selected=$(echo "${list[@]}" | fzf)
fi

if [[ -z $selected ]]; then
    exit 0
fi

session_name=$(basename "$selected" | tr . _)
tmux_running=$(pgrep -x tmux)

# If it's the first session
if [[ -z $TMUX ]] && [[ -z $tmux_running ]]; then
    tmux new-session -s $session_name -c $selected
    exit 0
fi

# If the session don't exist already, create it
if ! tmux has-session -t="$session_name" 2> /dev/null; then
    tmux new-session -ds $session_name -c $selected
fi
# Then switch to it
tmux switch-client -t $session_name
